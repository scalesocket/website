<!doctype html>
<html lang="en">
    <head>
        <title>ScaleSocket - Examples - Streaming a terminal to the browser</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
        <link
            rel="stylesheet"
            href="https://cdn.simplecss.org/simple.min.css"
        />
        <link
            rel="stylesheet"
            href="https://unpkg.com/@highlightjs/cdn-assets@11.10.0/styles/atom-one-dark.min.css"
        />
        <link rel="stylesheet" href="/utils.css" />
        <link rel="stylesheet" href="/style.css" />
        <script src="https://unpkg.com/@highlightjs/cdn-assets@11.10.0/highlight.min.js"></script>
        <script src="https://unpkg.com/@highlightjs/cdn-assets@11.10.0/languages/crmsh.min.js"></script>
        <script src="https://unpkg.com/@highlightjs/cdn-assets@11.10.0/languages/dockerfile.min.js"></script>
    </head>
    <body>
        <header>
            <nav>
                <a href="/" class="header-logo">
                    <img src="/assets/image.svg" alt="ScaleSocket" />
                </a>
                <a href="/index.html">Home</a>
                <a href="/docs/" class="active">Documentation</a>
                <a href="/download/">Download</a>
                <a
                    href="https://github.com/scalesocket/scalesocket"
                    class="header-logo header-logo-small ml"
                >
                    <img
                        src="/assets/github-mark.svg"
                        alt="GitHub logo"
                        class="pr-1"
                    />
                    GitHub
                </a>
            </nav>

            <div>
                <h1>Examples</h1>

                <p>
                   <a href="/docs/">&larr; Back</a>
                </p>
            </div>
        </header>

        <main>

        <h2 class="text-teal">Streaming a terminal to the browser.</h2>

       <p>
           In this example, we use <a href="https://en.wikipedia.org/wiki/Vim_(text_editor)">Vim</a> as a back end for ScaleSocket.
           We stream the <a href="https://en.wikipedia.org/wiki/Text-based_user_interface">TUI</a> to the browser using <a href="https://xtermjs.org/">Xterm.js</a> and websockets.
           The result is that multiple users can interact with the same Vim instance using the browser.
       </p>


        <figure>
          <img src="/examples/terminal-screenshot.png" />

          <figcaption>
            What the terminal streaming example looks like.
          </figcaption>
        </figure>



        <section>
            <h3>Running the example</h3>

            <p>
                Prerequisites:

                <ul>
                    <li>
                        <a href="https://www.docker.com/products/docker-desktop/">Docker desktop</a>
                    </li>
                </ul>
            </p>

            <p>
                You can get the source code and run this example with:

                <div class="code-figure">
                    <pre class="code-figure"><code class="language-bash hljs">git clone git@github.com:scalesocket/scalesocket.git
cd scalesocket/examples
docker compose up --build terminal
open http://localhost:9000/</code></pre>
                </div>

            </p>

            <h3>Front end</h3>

            <p>
                We'll create <code>index.html</code> with the following contents:
            </p>

            <div class="code-windows">
                <div class="code-window">
                    <div class="window-header">
                        <span class="window-title">public/index.html</span>
                    </div>
                    <pre><code class="language-html">&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
    &lt;title&gt;Terminal streaming example using ScaleSocket&lt;/title&gt;
    &lt;meta charset=&quot;utf-8&quot; /&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.simplecss.org/simple.min.css&quot; /&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/@xterm/addon-attach@0.12.0/lib/addon-attach.min.js &quot;&gt;&lt;/script&gt;
    &lt;link href=&quot;https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css&quot; rel=&quot;stylesheet&quot;&gt;
    &lt;style&gt;
        html, body { width: 100vw; overflow: hidden; }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;header&gt;
    &lt;p&gt;
        Rooms: &lt;a href=&quot;?room=room1&quot;&gt;room1&lt;/a&gt;, &lt;a href=&quot;?room=room2&quot;&gt;room2&lt;/a&gt;
    &lt;/p&gt;
&lt;/header&gt;

&lt;main&gt;
    &lt;div id=&quot;terminal&quot;&gt;&lt;/div&gt;
    &lt;p&gt;
        This example streams the &lt;a href=&quot;https://en.wikipedia.org/wiki/Vim_(text_editor)&quot;&gt;Vim&lt;/a&gt;
        command-line text editor to the browser.
    &lt;/p&gt;
    &lt;p&gt;
        Try writing &lt;code&gt;ihello world&amp;lt;esc&amp;gt;&lt;/code&gt;.
        Open multiple tabs to connect multiple times to the same room.
    &lt;/p&gt;
&lt;/main&gt;

&lt;script&gt;
    const $ = id =&gt; document.getElementById(id);
    const room = new URLSearchParams(location.search).get(&quot;room&quot;) || 'room1';
    const protocol = location.protocol === &quot;https:&quot; ? &quot;wss&quot; : &quot;ws&quot;
    const ws = new WebSocket(`${protocol}://${location.host}/${room}`);

    const term = new Terminal();
    term.loadAddon(new AttachAddon.AttachAddon(ws));
    term.open(document.getElementById('terminal'));

    ws.onopen = () =&gt; {
        term.focus();
        // ask `vim` to redraw the screen
        ws.send("\x1b:redraw!\n");
    }
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                </div>

            </div>


            <h3>Back end</h3>

            <p>
                We'll use the <code>vim</code> binary as our back end.
                Additionally, we'll wrap <code>vim</code> with <code>unbuffer</code> to expose a pseudo-terminal for improved compatibility.
            </p>

            <p>
                We'll use a <code>Dockerfile</code> with the following contents:
            </p>

            <div class="code-windows">
                <div class="code-window">
                    <div class="window-header">
                        <span class="window-title">Dockerfile</span>
                    </div>
                    <pre><code class="language-dockerfile"># syntax=docker/dockerfile:1.2
FROM scalesocket/scalesocket:latest
RUN apk add --no-cache\
    --repository http://dl-cdn.alpinelinux.org/alpine/edge/main\
    --repository http://dl-cdn.alpinelinux.org/alpine/edge/testing\
    expect vim

COPY index.html /var/www/public/index.html

CMD scalesocket\
    --binary\
    --staticdir /var/www/public/\
    unbuffer -- -p vim
</code></pre>
                </div>
            </div>

            <p>
                The <code>scalesocket/scalesocket:latest</code> docker image is based on Alpine linux.
                We use <code>apk</code> to install unbuffer (included in expect) and vim.
            </p>

            <p>
                We start vim using <code>scalesocket</code> in binary mode.
                Scalesocket will also serve the static HTML.
            </p>

            <p>To clone and run the complete example, do:</p>

            <div class="code-windows">

                <div class="code-window terminal">
                    <div class="window-header">
                        <span class="window-title">terminal</span>
                    </div>
                    <pre><code class="language-bash">git clone git@github.com:scalesocket/scalesocket.git
cd scalesocket/examples
docker compose up --build terminal</code></pre>
                </div>
            </div>

            <p>
                Then open <code>http://localhost:9000/</code> in your browser.
                You should see a working terminal interface running Vim.
            </p>
            <p>Try using <code>vim</code> and opening multiple browser tabs to connect to the same room multiple times.</p>

            <h3>How does it work?</h3>

            <p>
                The HTML frontend connects to the ScaleSocket server at <code>ws://localhost:9000/room1</code> using websockets.
                The back end spins up a new <code>vim</code> process for the room.
            </p>

            <p>
            </p>

            <p>
                The frontend uses <a href="https://www.npmjs.com/package/@xterm/xterm">Xterm.js</a> and <a href="https://www.npmjs.com/package/@xterm/addon-attach">xterm-addon-attach</a> to hook up a in-browser terminal to the websocket.
                When the frontend sends a key press, ScaleSocket passes it directly to the <i>stdin</i> of <code>vim</code>.
            </p>

            <p>
                When the <code>vim</code> TUI redraws the screen, the <i>stdout</i> is sent to all connected clients.
            </p>

        </section>

        <h2 class="text-teal">Next.</h2>

        <ul>
            <li>
                <a href="/examples/chat.html">Simple websocket chat using cat</a>
            </li>
            <li>
                <a href="/docs/usage.html">Usage</a>
            </li>
            <li>
                <a href="/docs/advanced-usage.html">Advanced usage</a>
            </li>
            <li>
                <a href="/docs/cli.html">Command-line reference</a>
            </li>
        </ul>

        <br />
        <br />
        <br />
        <br />


        </main>

        <script>
            hljs.highlightAll();
        </script>
    </body>
</html>
