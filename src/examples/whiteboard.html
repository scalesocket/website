<!doctype html>
<html lang="en">
    <head>
        <title>ScaleSocket - Examples - Real-time collaborative whiteboard</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
        <link
            rel="stylesheet"
            href="https://cdn.simplecss.org/simple.min.css"
        />
        <link
            rel="stylesheet"
            href="https://unpkg.com/@highlightjs/cdn-assets@11.10.0/styles/atom-one-dark.min.css"
        />
        <link rel="stylesheet" href="/utils.css" />
        <link rel="stylesheet" href="/style.css" />
        <script src="https://unpkg.com/@highlightjs/cdn-assets@11.10.0/highlight.min.js"></script>
        <script src="https://unpkg.com/@highlightjs/cdn-assets@11.10.0/languages/crmsh.min.js"></script>
        <script src="https://unpkg.com/@highlightjs/cdn-assets@11.10.0/languages/dockerfile.min.js"></script>
        <script src="https://unpkg.com/@highlightjs/cdn-assets@11.10.0/languages/typescript.min.js"></script>
    </head>
    <body>
        <header>
            <nav>
                <a href="/" class="header-logo">
                    <img src="/assets/image.svg" alt="ScaleSocket" />
                </a>
                <a href="/index.html">Home</a>
                <a href="/docs/" class="active">Documentation</a>
                <a href="/download/">Download</a>
                <a
                    href="https://github.com/scalesocket/scalesocket"
                    class="header-logo header-logo-small ml"
                >
                    <img
                        src="/assets/github-mark.svg"
                        alt="GitHub logo"
                        class="pr-1"
                    />
                    GitHub
                </a>
            </nav>

            <div>
                <h1>Examples</h1>

                <p>
                   <a href="/docs/">&larr; Back</a>
                </p>
            </div>
        </header>

        <main>

        <h2 class="text-teal">Real-time collaborative whiteboard.</h2>

       <p>
           In this example we build a collaborative whiteboard where multiple users can drag and move objects in real-time.
           The frontend uses <a href="https://pixijs.com/">PixiJS</a> for rendering, and a simple TypeScript server manages the shared state.
       </p>

        <figure>
          <img src="/examples/whiteboard.png" />

          <figcaption>
            Multiple users can drag objects around the whiteboard in real-time.
          </figcaption>
        </figure>

        <section>
            <h3>Running the example</h3>

            <p>
                Prerequisites:

                <ul>
                    <li>
                        <a href="https://www.docker.com/products/docker-desktop/">Docker desktop</a>
                    </li>
                </ul>
            </p>

            <p>
                You can get the source code and run this example with:

                <div class="code-figure">
                    <pre class="code-figure"><code class="language-bash hljs">git clone git@github.com:scalesocket/scalesocket.git
cd scalesocket/examples
docker compose up --build whiteboard
open http://localhost:9000/</code></pre>
                </div>

            </p>

            <h3>Architecture overview</h3>

            <p>
                This example demonstrates a more complex pattern with three key components:
            </p>

            <ul>
                <li><strong>TypeScript server</strong> &ndash; manages shared state and broadcasts updates</li>
                <li><strong>PixiJS frontend</strong> &ndash; renders an interactive canvas with draggable sprites</li>
                <li><strong>ScaleSocket</strong> &ndash; handles websocket connections and room management</li>
            </ul>

            <h3>Back end</h3>

            <p>
                The server is a simple TypeScript file that maintains the whiteboard state and handles two message types:
                <code>Join</code> (sent by ScaleSocket when a client connects) and <code>Move</code> (sent by clients when dragging objects).
            </p>

            <div class="code-windows">
                <div class="code-window">
                    <div class="window-header">
                        <span class="window-title">server.ts</span>
                    </div>
                    <pre><code class="language-typescript">import { createInterface } from 'readline';

const state = {
  'clip': { x: 125, y: 125 },
  'note': { x: 725, y: 200 },
  'globe': { x: 625, y: 700 },
  'floppies': { x: 225, y: 520 },
}

const send = (data: Object) => {
  console.log(JSON.stringify(data))
}

const onReceive = (e: string) => {
  const { t: type, ...data } = JSON.parse(e)
  switch (type) {
    case 'Join':
      console.error('Someone joined');
      send({ t: 'State', state })
      return
    case 'Move':
      if (data.key in state) {
        state[data.key] = data.position
        send({ t: 'State', state })
      }
      return
  }
}

// Messages are received by reading lines from stdin
createInterface({ input: process.stdin })
  .on('line', (line: string) => onReceive(line.trim()));</code></pre>
                </div>
            </div>

            <p>
                The server reads JSON messages from <i>stdin</i> and writes responses to <i>stdout</i>.
                ScaleSocket handles the websocket connections &mdash; the server just focuses on state management.
            </p>

            <h3>Front end</h3>

            <p>
                The frontend creates a PixiJS viewport where users can pan around and drag objects.
                When an object is dragged, the client sends a <code>Move</code> message.
                When receiving a <code>State</code> message, sprites smoothly interpolate to their new positions.
            </p>

            <p>
                An excerpt of the <code>frontend.js</code> file is shows us the basic building blocks for the front end:
            </p>

            <div class="code-windows">
                <div class="code-window">
                    <div class="window-header">
                        <span class="window-title">frontend.js (excerpt)</span>
                    </div>
                    <pre><code class="language-javascript">// Excerpt from `frontend.js`, see repo for full source.

export class Whiteboard {
  constructor(ws, viewport) {
    this.viewport = viewport;
    this.ws = ws;
    this.items = {};

    this.viewport.on('pointermove', (e) => this.onPointerMove(e));
    this.viewport.on('pointerup', (e) => this.onPointerUp(e));
    this.ws.onmessage = (e) => this.onMessage(e);
    // ...
  }

  onMessage(e) {
    const { t: type, ...payload } = JSON.parse(e.data);
    switch (type) {
      case 'State':
        this.updateState(payload.state);
        // ...
    }
  }

  sendMessage(data) {
    this.ws.send(JSON.stringify(data));
  }

  onPointerMove(e) {
    // Send position updates when dragging
    this.sendMessage({ t: 'Move', key, position });
    // ...
  }

  updateState(newState) {
    // Add new items and update positions
    for (const [key, position] of Object.entries(newState)) {
      if (!(key in this.items)) {
        this.items[key] = await this.addItem(key, position);
      } else {
        this.items[key].targetPosition = position;
      }
    }
    // ...
  }

  // ...
}</code></pre>
                </div>
            </div>

            <p>
                <a href="https://github.com/scalesocket/scalesocket/tree/main/examples/whiteboard">View full source code on GitHub &rarr;</a>
            </p>

            <h3>Docker configuration</h3>

            <p>
                The Dockerfile uses Node.js to run the TypeScript server:
            </p>

            <div class="code-windows">
                <div class="code-window">
                    <div class="window-header">
                        <span class="window-title">Dockerfile</span>
                    </div>
                    <pre><code class="language-dockerfile">FROM node:25-alpine

COPY --from=scalesocket/scalesocket:latest /usr/bin /usr/bin

COPY index.html frontend.js images/ /var/www/public/
COPY server.ts /app/server.ts

WORKDIR /app
CMD scalesocket\
    --staticdir /var/www/public/\
    --json\
    node -- server.ts</code></pre>
                </div>
            </div>

            <p>To clone and run the complete example, do:</p>

            <div class="code-windows">

                <div class="code-window terminal">
                    <div class="window-header">
                        <span class="window-title">terminal</span>
                    </div>
                    <pre><code class="language-bash">git clone git@github.com:scalesocket/scalesocket.git
cd scalesocket/examples
docker compose up --build whiteboard</code></pre>
                </div>
            </div>

            <p>
                Then open <code>http://localhost:9000/</code> in your browser.
                You should see a whiteboard with draggable objects.
            </p>
            <p>Try opening multiple browser tabs to see real-time synchronization across clients.</p>

            <h3>How does it work?</h3>

            <p>
                When a client connects, ScaleSocket sends a <code>Join</code> event to the server.
                The server responds with the current state, which the frontend uses to render the initial positions.
            </p>

            <p>
                When a user drags an object, the frontend sends throttled <code>Move</code> messages.
                The server updates its state and broadcasts the new positions to all connected clients.
            </p>

            <p>
                The frontend interpolates sprite positions to make movement appear smooth.
            </p>

        </section>

        <h2 class="text-teal">Next.</h2>

        <ul>
            <li>
                <a href="/docs/usage.html">Usage</a>
            </li>
            <li>
                <a href="/docs/advanced-usage.html">Advanced usage</a>
            </li>
            <li>
                <a href="/docs/cli.html">Command-line reference</a>
            </li>
        </ul>

        <br />
        <br />
        <br />
        <br />


        </main>

        <script>
            hljs.highlightAll();
        </script>
    </body>
</html>
