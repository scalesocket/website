<!doctype html>
<html lang="en">
    <head>
        <title>ScaleSocket - Examples - Simple websocket chat using cat</title>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png">
        <link
            rel="stylesheet"
            href="https://cdn.simplecss.org/simple.min.css"
        />
        <link
            rel="stylesheet"
            href="https://unpkg.com/@highlightjs/cdn-assets@11.10.0/styles/atom-one-dark.min.css"
        />
        <link rel="stylesheet" href="/utils.css" />
        <link rel="stylesheet" href="/style.css" />
        <script src="https://unpkg.com/@highlightjs/cdn-assets@11.10.0/highlight.min.js"></script>
        <script src="https://unpkg.com/@highlightjs/cdn-assets@11.10.0/languages/crmsh.min.js"></script>
        <script src="https://unpkg.com/@highlightjs/cdn-assets@11.10.0/languages/dockerfile.min.js"></script>
    </head>
    <body>
        <header>
            <nav>
                <a href="/" class="header-logo">
                    <img src="/assets/image.svg" alt="ScaleSocket" />
                </a>
                <a href="/index.html">Home</a>
                <a href="/docs/" class="active">Documentation</a>
                <a href="/download/">Download</a>
                <a
                    href="https://github.com/scalesocket/scalesocket"
                    class="header-logo header-logo-small ml"
                >
                    <img
                        src="/assets/github-mark.svg"
                        alt="GitHub logo"
                        class="pr-1"
                    />
                    GitHub
                </a>
            </nav>

            <div>
                <h1>Examples</h1>

                <p>
                   <a href="/docs/">&larr; Back</a>
                </p>
            </div>
        </header>

        <main>

        <h2 class="text-teal">Simple websocket chat using cat.</h2>

       <p>
           In this example we use <a href="https://en.wikipedia.org/wiki/Cat_(Unix)">cat</a> as the back end for ScaleSocket.
           The result is a naive chat website that uses websockets.
       </p>

        <figure>
          <img src="/examples/chat-screenshot.png" />

          <figcaption>
            What the chat example looks like.
          </figcaption>
        </figure>

        <section>
            <h3>Running the example</h3>

            <p>
                Prerequisites:

                <ul>
                    <li>
                        <a href="https://www.docker.com/products/docker-desktop/">Docker desktop</a>
                    </li>
                </ul>
            </p>

            <p>
                You can get the source code and run this example with:

                <div class="code-figure">
                    <pre class="code-figure"><code class="language-bash hljs">git clone git@github.com:scalesocket/scalesocket.git
cd scalesocket/examples
docker compose up --build chat
open http://localhost:9000/</code></pre>
                </div>

            </p>

            <h3>Architecture overview</h3>

            <p>
                This example demonstrates a minimal chat application with three components:
            </p>

            <ul>
                <li><strong>cat</strong> &ndash; echoes all input back to stdout, acting as a broadcast relay</li>
                <li><strong>HTML/JS frontend</strong> &ndash; simple chat interface with JSON messaging</li>
                <li><strong>ScaleSocket</strong> &ndash; handles websocket connections and JSON validation</li>
            </ul>

            <h3>Front end</h3>

            <p>
                We'll create <code>index.html</code> with the following contents:
            </p>

            <div class="code-windows">
                <div class="code-window">
                    <div class="window-header">
                        <span class="window-title">public/index.html</span>
                    </div>
                    <pre><code class="language-html">&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Chat Example using ScaleSocket&lt;/title&gt;
        &lt;meta charset="utf-8" /&gt;
        &lt;link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css" /&gt;
    &lt;/head&gt;
&lt;body&gt;
&lt;header&gt;
    &lt;p&gt;
        Rooms: &lt;a href="?room=room1"&gt;room1&lt;/a&gt;, &lt;a href="?room=room2"&gt;room2&lt;/a&gt;
    &lt;/p&gt;
&lt;/header&gt;

&lt;main&gt;
    &lt;textarea id="messages" readonly rows="20"&gt;&lt;/textarea&gt;
    &lt;input id="nick" placeholder="nickname" value="anonymous" /&gt;
    &lt;input id="message" placeholder="connecting..." disabled /&gt;
&lt;/main&gt;

&lt;script&gt;
    const $ = id =&gt; document.getElementById(id);
    const sanitize = str =&gt; str.replace(/[^a-zA-Z0-9 ]/g, '');
    const room = new URLSearchParams(location.search).get("room") || 'room1';
    const protocol = location.protocol === "https:" ? "wss" : "ws"
    const ws = new WebSocket(`${protocol}://${location.host}/${room}`);

    ws.onmessage = e =&gt; {
        const msg = JSON.parse(e.data);
        if (msg.t === "Join") {
            $("messages").value += `a participant joined the chat\n`;
        } else if (msg.t === "Leave") {
            $("messages").value += `a participant left the chat\n`;
        } else {
            $("messages").value += `&lt;${msg.nick}&gt; ${msg.text}\n`;
        }
        $("messages").scrollTop = $("messages").scrollHeight;
    };

    ws.onopen = () =&gt; {
        $("messages").value = `Connected to ${room}\n`;
        $("message").placeholder = "type message...";
        $("message").disabled = false;
        $("message").focus();
    };

    $("message").onkeyup = e =&gt; {
        if (e.key === 'Enter' && e.target.value.trim()) {
            const nick = sanitize($("nick").value) || "anonymous";
            const text = sanitize(e.target.value);
            if (text) {
                ws.send(JSON.stringify({ nick, text }));
                e.target.value = "";
            }
        }
    };
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>
                </div>

            </div>


            <h3>Back end</h3>

            <p>
                We'll use the existing <code>cat</code> binary as our back end.
                It's only purpose is to echo back whatever it receives to all clients.
            </p>

            <p>
                We'll use a <code>Dockerfile</code> with the following contents:
            </p>

            <div class="code-windows">
                <div class="code-window">
                    <div class="window-header">
                        <span class="window-title">Dockerfile</span>
                    </div>
                    <pre><code class="language-dockerfile"># syntax=docker/dockerfile:1.2
FROM scalesocket/scalesocket:latest
COPY index.html /var/www/public/index.html
CMD scalesocket\
    --json\
    --staticdir /var/www/public/\
    cat</code></pre>
                </div>
            </div>

            <p>
                The <code>scalesocket/scalesocket:latest</code> docker image is based on Alpine linux.
            </p>

            <p>
                We start cat using <code>scalesocket</code> in binary mode.
                Scalesocket will also serve the static HTML.
            </p>

            <p>To clone and run the complete example, do:</p>

            <div class="code-windows">

                <div class="code-window terminal">
                    <div class="window-header">
                        <span class="window-title">terminal</span>
                    </div>
                    <pre><code class="language-bash">git clone git@github.com:scalesocket/scalesocket.git
cd scalesocket/examples
docker compose up --build chat</code></pre>
                </div>
            </div>

            <p>
                Then open <code>http://localhost:9000/</code> in your browser.
                You should see a working chat interface.
            </p>
            <p>Try opening multiple browser tabs to connect to the same room multiple times.</p>

            <h3>How does it work?</h3>

            <p>
                The HTML frontend connects to the ScaleSocket server at <code>ws://localhost:9000/room1</code> using websockets.
                The back end spins up a new <code>cat</code> process for the room.
            </p>

            <p>
                When the frontend sends a chat message, ScaleSocket passes it directly to the <i>stdin</i> of <code>cat</code>.
            </p>

            <p>
                Since <code>cat</code> echoes all input it receives, the reply to <i>stdout</i> is the message itself, which ScaleSocket sends back to all connected clients.
            </p>

            <p>
                When <code>--json</code> is passed as an argument to ScaleSocket, it validates the websocket input to be JSON formatted objects.
                Additionally, it will send <code>{t:"Join", _id:1234}</code> events when new clients join.
            </p>
        </section>

        <h2 class="text-teal">Next.</h2>

        <ul>
            <li>
                <a href="/examples/whiteboard.html">Real-time collaborative whiteboard</a>
            </li>
            <li>
                <a href="/examples/terminal.html">Streaming a terminal to the browser</a>
            </li>
            <li>
                <a href="/docs/usage.html">Usage</a>
            </li>
            <li>
                <a href="/docs/advanced-usage.html">Advanced usage</a>
            </li>
            <li>
                <a href="/docs/cli.html">Command-line reference</a>
            </li>
        </ul>

        <br />
        <br />
        <br />
        <br />


        </main>

        <script>
            hljs.highlightAll();
        </script>
    </body>
</html>
